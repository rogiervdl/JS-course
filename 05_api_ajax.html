<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Javascript &mdash; Libraries</title>
  <meta name="author" content="Rogier van der Linde - ikdoeict.be">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <link rel="stylesheet" href="fonts/droidsans/webfont.css">
  <link rel="stylesheet" href="fonts/lato/webfont.css">
  <link rel="stylesheet" href="fonts/leaguegothic/webfont.css">
  <link rel="stylesheet" href="vendor/reveal/css/reveal.css">
  <link rel="stylesheet" href="vendor/reveal/css/theme/beige.css">
  <link rel="stylesheet" href="vendor/highlight/styles/vs.css">
  <link rel="stylesheet" href="css/reveal-mods.css">
  <link rel="stylesheet" href="css/common.css">
  <link rel="stylesheet" href="css/05_api_ajax.css">
</head>

<body>

  <!-- SLIDES -->
  <div class="reveal">

    <!-- Any section element inside of this container is displayed as a slide -->
    <div class="slides">

      <!-- 0 : Title -->
      <section>
        <h1>API's &amp; Ajax</h1>
        <small>use the arrow keys to navigate; press space for slide overview<br /></small>
        <figure style="width: 380px; margin: 0 auto">
          <img src="img/05_api_ajax/icon.png" alt="" width="380" />
        </figure>

        <footer>
          <a href="http://www.odisee.be/">odisee.be</a> &mdash; <a href="mailto:rogier.vanderlinde@odisee.be">rogier.vanderlinde@odisee.be</a>
        </footer>
      </section>
      <section>
        <section>
          <h1>API's &amp; Ajax</h1>
          <h2>Client&ndash;server model</h2>
          <ul class="chapterlist">
            <!-- to be filled by Javascript -->
          </ul>
        </section>
        <section>
          <h2>HTTP Client&ndash;Server model</h2>
          <ul>
            <li>
              In order to use API's and AJAX, it is very important to understand how the HTTP client&ndash;server model works. Some definitions:
              <ul>
                <li>a <em>resource</em> is an HTML page, CSS file, JS script, image, font...</li>
                <li>a <em>client</em> is the software requesting a resource: browser, app, program...</li>
                <li>a <em>server</em> is the software/hardware hosting and delivering resources to clients</li>
                <li>a <em>request</em> is a message from client to server</li>
                <li>a <em>response</em> is a message back from the server to the client</li>
              </ul>
            </li>
          </ul>  
        </section>
        <section>
          <h2>HTTP Client&ndash;Server model</h2>
          <ul>
            <li>
              A request/response has three steps:
              <ul>
                <li>step 1: the client <em>sends a request</em> to the server</li>
                <li>step 2: the server <em>processes the request</em></li>
                <li>step 3: the server <em>returns a response</em> to the client</li>
              </ul>
            </li>
          </ul>  
          <figure style="max-width: 600px; margin-top: 20px">
            <img src="img/05_api_ajax/http.png" alt="http" style="border: 0; display: block;">
            <figcaption>source: <a href="https://www.ntu.edu.sg/home/ehchua/programming/webprogramming/HTTP_Basics.html">www.ntu.edu.sg</a></figcaption>
          </figure>
        </section>
        <section data-toc-title="Step 1: HTTP request">
          <h2>Step 1: HTTP request (1)</h2>
          <ul>
            <li>
              An HTTP request message has the following parts: 
              <ul>
                <li><em>request line</em>: contains <strong>URL</strong>, <strong>method</strong> and <strong>HTTP version</strong></li>
                <li><em>request headers</em>: contains <strong>extra info</strong> like browser/OS version, expected response type...</li>
                <li><em>request body</em>: contains <strong>data attached</strong> to the request</li>
              </ul>
            </li>
            <li>
              Example of a HTTP GET request to retrieve an image:
            </li>
          </ul>  
          <figure>
            <img src="img/05_api_ajax/request1.png" alt="http" style="border: 0; display: block;margin-bottom:20px;">
          </figure>
        </section>
        <section data-toc-title="">
          <h2>Step 1: HTTP request (2)</h2>
          <ul>
            <li>
              The request <em>method</em> defines which action is required from the server. Many methods exist (<a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Methods">overview</a>), but the only two important are:
              <ul>
                <li><em>GET</em>: retrieve data</li>
                <li><em>POST</em>: send data (e.g. form data, uploaded file...)</li>
              </ul> 
            </li>
            <li>
              The main difference between GET and POST is that a POST request body can contain data. Example of a POST request with login data sent to a PHP server script <strong>login.php</strong>:
            </li>
          </ul>  
          <figure>
            <img src="img/05_api_ajax/request2.png" alt="http" style="border: 0; display: block;margin-bottom:20px">
          </figure>
        </section>
        <section data-toc-title="">
          <h2>Step 1: HTTP request (3)</h2>
          <ul>
            <li>
              Example of a POST request to upload a file to a ASP.NET server script <strong>upload.aspx</strong>:
            </li>
          </ul>  
          <figure>
            <img src="img/05_api_ajax/request3.png" alt="http" style="border: 0; display: block;margin-bottom:20px">
          </figure>
        </section>
        <section>
          <h2>Step 2: Processing the request</h2>
          <ul>
            <li>
              When the server receives the request, a lot of magic happens: locating resources, checking permissions, executing scripts... This lies outside the scope of this course, so we'll just consider the server a black box:
            </li>
          </ul>  
          <figure style="max-width: 600px">
            <img src="img/05_api_ajax/magic.png" alt="http" style="border: 0; display: block;margin-bottom:20px">
          </figure>
        </section>
        <section>
          <h2>Step 3: HTTP response</h2>
          <ul>
            <li>
              The HTTP response message is similar to the HTTP request:
              <ul>
                <li><em>response line</em>: contains <strong>HTTP version</strong> and <strong>status code</strong> (e.g. 200=ok, 403=forbidden, 404=not found...)</li>
                <li><em>response headers</em>: contains <strong>extra info</strong> like compression type, content type...</li>
                <li><em>response body</em>: contains the requested resource (e.g. image, HTML code...)</li>
              </ul>
            </li>
          </ul>  
          <figure>
            <img src="img/05_api_ajax/response.png" alt="http" style="border: 0; display: block;margin-bottom:20px;">
          </figure>
        </section>
        <section>
          <h2>Initiating a HTTP request</h2>
          <ul>
            <li>
              HTTP requests can be initiated in many ways. 
            </li>
            <li>
              If you just want to retrieve an URL content, you can
              <ul>
                <li><strong>enter a URL</strong> in the address bar (browser)</li>
                <li><strong>click a link</strong> in a page, email, PDF...</li>
              </ul>
            </li>
            <li>
              If you want to test a HTTP request with control over custom headers, body content, method..., you can build and send a request
              <ul>
                <li>with the <a href="https://chrome.google.com/webstore/detail/postman/fhbjgbiflinjbdggehcddcbncdddomop?hl=en">Chrome Postman plugin</a></li>
                <li>on Linux based machines from the <strong>terminal</strong> with the <code>curl</code> command</li>
              </ul>
            </li>
            <li>
              Finally, you can also send requests from scripts:
              <ul>
                <li>from a <strong>.NET application</strong> with the <a href="https://docs.microsoft.com/en-us/dotnet/api/system.net.webrequest?view=netframework-4.8">System.NET.WebRequest</a> class</li>
                <li>from a <strong>PHP server script</strong> with the <a href="https://www.php.net/curl">cUrl module</a></li>
                <li><em>from Javascript with the fetch() method</em> <span class="darkgreen">&rarr; this will be the focus of this presentation</span></li>
              </ul>
            </li>
          </ul>

        </section>
        <section data-toc-title="Inspecting request/response">
          <h2>Inspecting request/response (1)</h2>
          <ul>
            <li>
              In the browser you can inspect request/responses on the Network tab of Chrome devtools. Example when requesting the Toledo portal page:
            </li>
          </ul>  
          <figure style="max-width: 800px; display: block; margin: 0 auto">
            <img src="img/05_api_ajax/devtools_request1.png" alt="http" style="border: 1px solid #ccc; display: block;margin-bottom:20px;">
          </figure>
        </section>
        <section data-toc-title="">
          <h2>Inspecting request/response (2)</h2>
          <div style="display: flex; justify-content: space-between;">
            <div style="width: 40%;">
              <figure style="display: block; margin: 0 auto">
                <img src="img/05_api_ajax/devtools_request2.png" alt="http" style="border: 1px solid #ccc; display: block;margin-bottom:20px;">
              </figure>
            </div>
            <div style="width: 60%; padding-left: 10px">
              <ul>
                <li class="no-style">
                  Note that this request generates a waterfall of other requests:
                  <ul>
                    <li>first the main URL is loaded, <strong>portal/</strong>; the response will return the HTML of the page</li>
                    <li>then all resources linked in the HTML (images, CSS, scripts...) are loaded in the order in which they appear</li>
                    <li>then all resources linked to these resources are loaded (e.g. images in CSS, audi in scripts...)</li>
                    <li>...</li>
                  </ul>
                </li>
              </ul>
            </div>
          </div>
        </section>
        <section data-toc-title="">
          <h2>Inspecting request/response (3)</h2>
          <div style="display: flex; justify-content: space-between;">
            <div style="width: 50%;">
              <figure style="display: block; margin: 0 auto">
                <img src="img/05_api_ajax/devtools_request3.png" alt="http" style="border: 1px solid #ccc; display: block;margin-bottom:20px;">
              </figure>
            </div>
            <div style="width: 50%; ">
              <ul>
                <li class="no-style">
                  Click on a request to inspect:
                  <ul>
                    <li>request URL, status code</li>
                    <li>request and response headers</li>
                    <li>response body</li>
                    <li>...</li>
                  </ul>
                </li>
                <li class="no-style">
                  Response status codes:
                  <ul>
                    <li>200 - get ok</li>
                    <li>201 - create ok</li>
                    <li>301 - permanently moved</li>
                    <li>400 - bad request (missing parameters)</li>
                    <li>401 - not authorized (e.g. API key not given)</li>
                    <li>404 - requested data not found</li>
                    <li>405 - method not allowed (e.g. wrong verb)</li>
                    <li>500 - internal server error</li>
                  </ul>
                </li>
              </ul>
            </div>
          </div>
        </section>
        <section data-toc-title="">
          <h2>Inspecting request/response (4)</h2>
          <div style="display: flex; justify-content: space-between;">
            <div style="width: 50%;">
              <figure style="display: block; margin: 0 auto">
                <img src="img/05_api_ajax/devtools_request4.png" alt="http" style="border: 1px solid #ccc; display: block;margin-bottom:20px;">
              </figure>
            </div>
            <div style="width: 50%; ">
              <ul>
                <li class="no-style">
                  Example showing the response for a CSS file request
                </li>
              </ul>
            </div>
          </div>
        </section>
        <section data-toc-title="">
          <h2>Inspecting request/response (5)</h2>
          <ul>
            <li>
              A great tool for creating requests and inspecting responses is the <a href="https://chrome.google.com/webstore/detail/postman/fhbjgbiflinjbdggehcddcbncdddomop?hl=en">Chrome Postman plugin</a>:
            </li>
          </ul>  
          <figure style="max-width: 600px; display: block; margin: 0 auto">
            <img src="img/05_api_ajax/postman.png" alt="http" style="border: 0; display: block;margin-bottom:20px;">
          </figure>
        </section>
      </section>
      <section>
        <section>
          <h1>API's &amp; Ajax</h1>
          <h2>API's</h2>
          <ul class="chapterlist">
            <!-- to be filled by Javascript -->
          </ul>
        </section>
        <section>
          <h2>What is an API</h2>
          <ul>
            <li>
              An <em>API</em> (Application Programming Interface) is a software service that offers a <em>set of functions</em> that other applications can consume remotely:
              <ul>
                <li>reading &amp; searching data</li>
                <li>weather service</li>
                <li>updating content</li>
                <li>authentication</li>
                <li>complex calculations</li>
                <li>image compression/conversion</li>
                <li>...</li>
              </ul>
            </li>
          </ul>

        </section>
        <section>
          <h2>What is a Web API</h2>
          <ul>
            <li>
              In a web context it is called a <i>web API</i>. It follows the client&ndash;server model:
              <ul>
                <li>the web application sends a <strong>request</strong> to the API, optionally with request data</li>
                <li>the API function sends back a <strong>response</strong>, optionally with readable response data</li>
              </ul>
            </li>
            <li>
              Benefits from <strong>consuming</strong> a web API:
              <ul class="v-style">
                <li>
                  integrate <a href="http://www.flickr.com/services/api/">Flickr</a> or <a href="https://dev.twitter.com/docs">Twitter</a> in your website
                </li>
                <li>
                  get directions, time zones &amp; other information from <a href="https://developers.google.com/maps/documentation/webservices/?hl=nl">Google Maps API</a>
                </li>
                <li>
                  build cool apps with <a href="https://data.stad.gent/">Open Data Portaal Ghent</a>
                </li>
              </ul>
            </li>
            <li>
              Benefits from <strong>offering</strong> a web API:
              <ul class="v-style">
                <li>
                  make your products information available for price aggregators
                </li>
                <li>
                  split your huge application in smaller independent components
                </li>
                <li>
                  see how people build cool stuff with your data
                </li>
              </ul>
            </li>
          </ul>
        </section>
        <section data-toc-title="Finding Web API's">
          <h2>Finding Web API's (1)</h2>
          <ul>
            <li>
              Almost all large web applications like Youtube, Google Maps, Dropbox, Twitter, Flickr etc. have web API's that you can use as a developer. 
            </li>
            <li>
              Just Google the API, e.g. search for "Flickr API", and you'll find the docs:
            </li>
          </ul>
          <figure style="max-width: 700px; display: block; margin: 0 auto">
            <img src="img/05_api_ajax/flickr-api.png" alt="http" style="border: 1px solid #ccc; display: block;margin-bottom:20px;">
          </figure>
        </section>
        <section data-toc-title="">
          <h2>Finding Web API's (2)</h2>
          <ul>
            <li>
              Smaller dedicated API's also exist, e.g. weather service, dog pictures, funny quotes... Finding them may be a little harder; <a href="https://rapidapi.com/">rapidapi.com</a> has a nice collection:
            </li>
          </ul>
          <figure style="max-width: 700px; display: block; margin: 0 auto">
            <img src="img/05_api_ajax/rapidAPI.png" alt="http" style="border: 1px solid #ccc; display: block;margin-bottom:20px;">
          </figure>
        </section>
        <section data-toc-title="Using Web API's">
          <h2>Using Web API's (1)</h2>
          <ul>
            <li>
              How you can use a web API varies greatly, from very simple to very difficult. You will have to study the documentation. Things to consider:
              <ul>
                <li>
                  <strong>authentication</strong>: 
                  <ul>
                    <li>some API's are completely open (no effort)</li>
                    <li>some require you to apply for an API key that you have to include with every request (easy)</li>
                    <li>some require complex authentication methods like OAuth (too difficult for this course)</li>
                  </ul> 
                </li>
                <li>
                  <strong>price/quota</strong>: 
                  <ul>
                    <li>a few API's are still free and unlimited (but less and less)</li>
                    <li>most API's are free but have daily quota linked to the API key</li>
                    <li>in all other cases, you'll have to open your wallet</li>
                  </ul> 
                </li>
                <li>
                  <strong>request</strong>: 
                  <ul>
                    <li>make sure the REST (URL-based) request format is supported, beware of older formats like SOAP or XML-RPC</li>
                    <li>for the name of the functions and parameters, check the documentation</li>
                    <li>some API's require you to include extra headers with the request (e.g. API key)</li>
                  </ul> 
                </li>
                <li>
                  <strong>response</strong>: 
                  <ul>
                    <li>the response may have any format (XML, HTML, plain text...), but the most common and easiest is JSON (JavaScript Object Notation, see further); make sure it is supported</li>
                  </ul> 
                </li>
              </ul>  
            </li>
          </ul>
        </section>
        <section data-toc-title="">
          <h2>Using Web API's (2)</h2>
          <ul>
            <li>
              To summarize, if you pick a web API, make sure:
              <ul>
                <li>
                   the API is <strong>open</strong> or requires a simple <strong>API key</strong> which you can get by easy registration
                </li>
                <li>
                   the API is <strong>free</strong> or has sufficient free daily quota
                </li>
                <li>
                    the <strong>REST</strong> request format is supported
                </li>
                <li>
                    the <strong>JSON</strong> response format is supported
                </li>
                <li>
                    it is <strong>well-documented</strong> and easy to use
                </li>
              </ul>  
            </li>
          </ul>
        </section>
        <section>
          <h2>Open API example</h2>
          <ul>
            <li>
              If no key or authentication is needed, it is called an <em>open API</em>. 
            </li>
            <li>
              To get an idea, just a few quick examples from the <a href="https://dog.ceo/dog-api/documentation/">Dog API</a>. The request is very simple, just an URL, so we can use the browser to fetch the contents: 
              <ul>
                <li>get a random image: <a href="https://dog.ceo/api/breed/hound/images/random">https://dog.ceo/api/breed/hound/images/random</a></li>
                <li>get a list of sub-breeds of the Retriever: <a href="https://dog.ceo/api/breed/retriever/list">https://dog.ceo/api/breed/retriever/list</a></li>
              </ul>
            </li>
          </ul>
          <figure style="max-width: 600px; display: block; margin: 0 auto">
            <img src="img/05_api_ajax/dogAPi-example.png" alt="http" style="border: 0; display: block;margin-bottom:20px;">
          </figure>
        </section>
        <section data-toc-title="API key example">
          <h2>API key example (1)</h2>
          <ul>
            <li>
              Most API's will <a href="https://www.flickr.com/services/api/misc.api_keys.html">require you to register</a> to get a (usually free) API key. You need to include this key with every request, either as a GET parameter, or with a custom header.  
            </li>
            <li>
              An example from <a href="https://www.flickr.com/services/api/">Flickr API</a>:
              <ul>
                <li>search for images by tag: <a href="https://api.flickr.com/services/rest/?method=flickr.photos.search&extras=url_m&per_page=20&api_key=6ecfcd8d4a3b8a04da6093733db989a2&text=atomium&format=json">https://api.flickr.com/services/rest/?method=flickr.photos.search&extras=url_m&per_page=20 &text=atomium<strong>&api_key=6ecfcd8d4a3b8a04da6093733db989a2</strong>&format=json</a></li>
              </ul>
            </li>
          </ul>
          <figure style="max-width: 600px; display: block; margin: 0 auto">
            <img src="img/05_api_ajax/flickr1.png" alt="http" style="border: 1px solid #ccc; display: block;margin-bottom:20px;">
          </figure>
        </section>
        <section data-toc-title="">
          <h2>API key example (2)</h2>
          <ul>
            <li>
              You can do the same request with Postman:
            </li>
          </ul>
          <figure style="max-width: 700px; display: block; margin: 0 auto">
            <img src="img/05_api_ajax/flickr2.png" alt="http" style="border: 0; display: block;margin-bottom:20px;">
          </figure>
        </section>
        <section data-toc-title="About JSON">
          <h2>About JSON (1)</h2>
          <ul>
            <li>
              <em>JSON</em> (Javascript Object Notation) is a string representation of a single Javascript object holding all information.
            </li>
            <li>
              An example JSON string is  <code style="font-size: smaller">{"course":"RIA","lecturers":[{"id":1,"name":"Davy De Winne"},{"id": 2,"name": "Bramus Van Damme"}]}</code>, or in a more readable layout (use <a href="https://jsonformatter.curiousconcept.com/">this beautifier</a>):
              <pre class="bigger"><code contenteditable class="language-javascript">{
  "course": "RIA",
  "lecturers": [
    {
      "id": 1,
      "name": "Davy De Winne"
    },
    {
      "id": 2,
      "name": "Bramus Van Damme"
    }
  ]
}</code></pre>
            </li>
          </ul>
        </section>
        <section data-toc-title="">
          <h2>About JSON (2)</h2>
          <ul>
            <li>
              JSON is basically a keys-values tree, where
              <ul>
                <li>
                  <em>keys</em> are <code>string</code> (double quotes required!)
                </li>
                <li>
                  <em>values</em> are <code>string</code>, <code>number</code>, <code>Object</code>, <code>Array</code>, <code>boolean</code> or <code>null</code>
                </li>
              </ul>
            </li>
            <li>
              Well supported in most programming languages (PHP, .NET, Javascript...)
            </li>
            <li>
              JSON FTW!
              <ul>
                <li>easy to work with (clientside and serverside)</li>
                <li>less overhead than other response formats like XML</li>
                <li>supported by all modern web API's</li>
              </ul>
            </li>
          </ul>
        </section>
      </section>
      <section>
        <section>
          <h1>API's &amp; Ajax</h1>
          <h2>AJAX with fetch()</h2>
          <ul class="chapterlist">
            <!-- to be filled by Javascript -->
          </ul>
        </section>
        <section>
          <h2>About AJAX</h2>
          <ul>
            <li>
              Now our final question: how can we use web API's in Javascript? 
            </li>
            <li>
              The technique to make a request to a server from Javascript is called <em>AJAX</em>:
              <ul>
                <li>Asynchronous Javascript and XML</li>
                <li>allows loading extra resources and data without leaving the page</li>
                <li>originally created by developers of Outlook Web Access (Microsoft) back in 2000, later picked up by Google in Google suggest</li>
              </ul>
            </li>
            <li>
              There are various ways to implement an AJAX call:
              <ul>
                <li>oldest: with the <code><strong>XMLHttpRequest</strong></code> object</li>
                <li>newer: with specialized libraries, e.g. <strong>jQuery</strong></li>
                <li>newest: with the new Javascript <code><strong>fetch()</strong></code> method, now <a href="https://caniuse.com/#search=fetch">widely supported</a></li>
              </ul>
            </li>
          </ul>
        </section>
        <section>
          <h2>XMLHttpRequest syntax</h2>
          <ul>
            <li>
              The XMLHttpRequest syntax (check your console):
              <pre class="bigger"><code contenteditable class="language-javascript overlayrun wrong">let xhr = new XMLHttpRequest();
xhr.addEventListener('readystatechange', function() {
  if (this.readyState == 4 && this.status == 200) {
    console.log('data received: ', this.responseText);
  }
});
xhr.open('GET', 'https://dog.ceo/api/breed/hound/images/random', false);
xhr.send();</code></pre>
            </li>
          </ul>
          <ul class="arrow">
            <li class="darkred">hard to use; I wouldn't recommend this syntax</li>
          </ul>
        </section>
        <section>
          <h2>JQUERY syntax</h2>
          <ul>
            <li>
              The jQuery syntax (check your console):
              <pre class="bigger"><code contenteditable class="language-javascript overlayrun wrong">jQuery.ajax({
  url: 'https://dog.ceo/api/breed/hound/images/random',
  method: 'GET',
  success: function(result) {
    console.log('data received: ', result);
  },
  error: function(err) {
    alert('request failed: ', err);
  }
});</code></pre>
            </li>
          </ul>
          <ul class="arrow">
            <li class="darkred">requires an external library (jQuery)</li>
            <li class="darkred">is easier to use, but I wouldn't recommend using this syntax either</li>
          </ul>
        </section>
        <section data-toc-title="fetch() syntax">
          <h2>fetch() syntax (1)</h2>
          <ul>
            <li>
              The fetch() syntax (check your console):
              <pre class="bigger"><code contenteditable class="language-javascript overlayrun right">let url = 'https://dog.ceo/api/breed/hound/images/random';
fetch(url)
  // handle response
  .then(function(resp) {
      console.log('response status: ', resp.status);
      return resp.json();
  })
  // handle response data
  .then(function handleSuccess(data) {
      console.log('data received: ', data);
  })
  // catch errors
  .catch(function(err) {
      console.log('request failed: ', err)
  });</code></pre>
            </li>
          </ul>
          <ul class="arrow">
            <li class="darkgreen">this is the way to go!</li>
          </ul>
        </section>
        <section data-toc-title="">
          <h2>fetch() syntax (2)</h2>
          <ul>
            <li>
              If you prefer, you can use named functions instead of anonymous:
              <pre class="bigger"><code contenteditable class="language-javascript overlayrun">let url = 'https://dog.ceo/api/breed/hound/images/random';
function handleResponse(resp) {
  console.log('response status: ', resp.status);
  return resp.json();
}                
function handleSuccess(data) {
  console.log('data received: ', data);
}
function handleError(err) {
  console.log('request failed: ', err)
}
fetch(url)
  .then(handleResponse)
  .then(handleSuccess)
  .catch(handleError);</code></pre>
            </li>
          </ul>
          <ul class="arrow">
            <li class="darkgreen">this is the way to go!</li>
          </ul>
        </section>
        <section data-toc-title="">
          <h2>fetch() syntax (3)</h2>
          <ul>
            <li>
              Another example from the <a href="https://rapidapi.com/matchilling/api/chuck-norris">Chuck Norris API</a>, an API that requires custom headers:
              <pre class="bigger"><code contenteditable class="language-javascript overlayrun">let url = 'https://matchilling-chuck-norris-jokes-v1.p.rapidapi.com/jokes/random';
let options = {
  headers: {
    'X-RapidAPI-Host': 'matchilling-chuck-norris-jokes-v1.p.rapidapi.com',
    'X-RapidAPI-Key': 'FLd7sJMCXBmshkCvZXkHKWBWSYt6p1lHgIZjsnuLCh9gVyZf1I'
  }
};                
fetch(url, options)
  // handle response
  .then(function(resp) {
      console.log('response status: ', resp.status);
      return resp.json();
  })
  // handle response data
  .then(function handleSuccess(data) {
      alert(data.value);
  })
  // catch errors
  .catch(function(err) {
      console.log('request failed: ', err)
  });</code></pre>
            </li>
          </ul>
        </section>
        <section data-toc-title="AJAX Flickr demo">
          <h2>AJAX Flickr demo (1)</h2>
          <ul>
            <li>
              Let's build a small application using the Flickr API. The HTML and CSS:
              <pre class="bigger"><code class="language-html">&lt;!DOCTYPE html&gt;
&lt;head&gt;
  &lt;title&gt;Ajax example&lt;/title&gt;
  &lt;meta charset="utf-8"&gt;
  &lt;style&gt;
    #pics {
      display: flex
      flex-flow: row wrap;
    }
    #pics img {
      height: 200px;
      display: block;
      margin-top: 20px;
      margin-right: 20px;
    }
  &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
  &lt;input id="search" type="text" placeholder="search here" /&gt;
  &lt;div id="pics"&gt;&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
            </li>
          </ul>
        </section>
        <section data-toc-title="">
          <h2>AJAX Flickr demo (2)</h2>
          <ul>
            <li>
              The Javascript fragment for making our API call:
              <pre class="bigger"><code class="language-javascript">// base URL
let base = "https://api.flickr.com/services/rest/?";

// append parameters
let params = new URLSearchParams();
params.append('method', 'flickr.photos.search');
params.append('extras', 'url_m');
params.append('per_page', 20);
params.append('format', 'json');
params.append('nojsoncallback', 1);
params.append('api_key', '6ecfcd8d4a3b8a04da6093733db989a2');
params.append('text', searchval);
let url = base + params.toString();

// AJAX call
fetch(url)
    .then(onResponse) // TODO: implement onResponse
    .then(onSuccess) // TODO: implement onSuccess
    .catch(function(err) {
        console.log('Request failed', err)
    });</code></pre>
            </li>
          </ul>
          <ul class="arrow">
            <li>note that we use the URLSearchParams() object to build our parameter list; this is <a href="https://fetch.spec.whatwg.org/#fetch-api">recommended by the Fetch standard</a></li>
          </ul>
        </section>
        <section data-toc-title="">
          <h2>AJAX Flickr demo (3)</h2>
          <ul>
            <li>
              The complete script:
              <pre class="bigger"><code class="language-javascript">window.addEventListener('load', function() {
    // DOM 
    let pics = document.getElementById('pics');
    let search = document.getElementById('search');

    // search field event
    search.addEventListener('keypress', function(e) {
        if (e.which == 13) {
            pics.innerHTML = '';
            makeSearch(this.value);
        }
    });

    // handle fetch response
    function onResponse(res) {
        // error
        if (res.status < 200 || res.status >= 300) {
            console.log('error with status ' + res.status);
        } else {
            console.log('response ok ' + res.status);
            return res.json();
        }
    }

    // handle fetch data
    function onSuccess(data) {
        // all ok
        for (let i = 0; i < data.photos.photo.length; i++) {
            let img = document.createElement('img');
            if (data.photos.photo[i].url_m) img.setAttribute('src', data.photos.photo[i].url_m);
            pics.appendChild(img);
        }
    }

    // make the search
    function makeSearch(searchval) {
        // base URL
        let base = "https://api.flickr.com/services/rest/?";

        // append parameters
        let params = new URLSearchParams();
        params.append('method', 'flickr.photos.search');
        params.append('extras', 'url_m');
        params.append('per_page', 20);
        params.append('format', 'json');
        params.append('nojsoncallback', 1);
        params.append('api_key', '6ecfcd8d4a3b8a04da6093733db989a2');
        params.append('text', searchval);
        let url = base + params.toString();

        // AJAX call
        fetch(url)
            .then(onResponse) 
            .then(onSuccess) 
            .catch(function(err) {
                console.log('Request failed', err)
            });
        }
    }
});
</code></pre>
              <div class="demolink"><a href="demos/05_api_ajax/flickr_fetch.html">demo</a></div>
            </li>
          </ul>
        </section>
        <section>
          <h2>Things to consider</h2>
          <ul>
            <li>
              AJAX is essential in modern web development:
              <ul class="v-style">
                <li>no reloads</li>
                <li>faster</li>
                <li>less bandwith used</li>
              </ul>
            </li>
            <li>
              But beware:
              <ul class="x-style">
                <li>no browser history, back button is broken, no bookmarking</li>
                <li>search engines do not always index injected content</li>
              </ul>
            </li>
          </ul>
        </section>
      </section>

    </div>

    <!-- odisee.be link -->
    <a href="http://www.odisee.be/" title="odisee.be" id="odisee"><img src="img/odisee.png" alt="Odisee logo"></a>


    <!-- Index Link -->
    <aside class="back">
      <nav>
        <p><a href="index.html">&larr; Back to index</a></p>
      </nav>
    </aside>

  </div>

  <script src="vendor/jquery.min.js"></script>
  <script src="vendor/reveal/lib/js/head.min.js"></script>
  <script src="vendor/reveal/js/reveal.js"></script>
  <script src="vendor/highlight/highlight.pack.js"></script>
  <script src="vendor/incrementable.js"></script>
  <script src="vendor/prefixfree.js"></script>
  <script src="vendor/css-snippets.js"></script>
  <script src="vendor/css-edit.js"></script>
  <script src="js/main.js"></script>
  <script>
    var devtools = /./;
      devtools.toString = function() {
      this.opened = true;
    }
    console.log('%c', devtools);
    if (!devtools.opened) {
//      alert('some demos show their results in the console, so keep it open (press F12 or Shift-Ctrl-I)');
    }
  </script>

</body>
</html>
