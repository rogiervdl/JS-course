<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Javascript &mdash; Libraries</title>
  <meta name="author" content="Rogier van der Linde - ikdoeict.be">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <link rel="stylesheet" href="fonts/droidsans/webfont.css">
  <link rel="stylesheet" href="fonts/lato/webfont.css">
  <link rel="stylesheet" href="fonts/leaguegothic/webfont.css">
  <link rel="stylesheet" href="vendor/reveal/css/reveal.css">
  <link rel="stylesheet" href="vendor/reveal/css/theme/beige.css">
  <link rel="stylesheet" href="vendor/highlight/styles/vs.css">
  <link rel="stylesheet" href="css/reveal-mods.css">
  <link rel="stylesheet" href="css/common.css">
  <link rel="stylesheet" href="css/05_api_ajax.css">
</head>

<body>

  <!-- SLIDES -->
  <div class="reveal">

    <!-- Any section element inside of this container is displayed as a slide -->
    <div class="slides">

      <!-- 0 : Title -->
      <section>
        <h1>API's &amp; Ajax</h1>
        <small>use the arrow keys to navigate; press space for slide overview<br /></small>
        <figure style="width: 380px; margin: 0 auto">
          <img src="img/05_api_ajax/icon.png" alt="" width="380" />
        </figure>

        <footer>
          <a href="http://www.odisee.be/">odisee.be</a> &mdash; <a href="mailto:rogier.vanderlinde@odisee.be">rogier.vanderlinde@odisee.be</a>
        </footer>
      </section>
      <section>
        <section>
          <h1>API's &amp; Ajax</h1>
          <h2>API's</h2>
          <ul class="chapterlist">
            <!-- to be filled by Javascript -->
          </ul>
        </section>
        <section>
          <h2>About WEB API's</h2>
          <ul>
            <li>
              Generally, an <em>API</em> (Application Programming Interface) is software that offers functionality that other applications can consume remotely:
              <ul>
                <li>reading &amp; searching data</li>
                <li>updating content</li>
                <li>authentication</li>
                <li>...</li>
              </ul>
              In a web context an API is called a <i>web API</i>
            </li>
            <li>
              Benefits from <strong>consuming</strong> a web API:
              <ul class="v-style">
                <li>
                  integrate <a href="http://www.flickr.com/services/api/">Flickr</a> or <a href="https://dev.twitter.com/docs">Twitter</a> in your website
                </li>
                <li>
                  get directions, time zones &amp; other information from <a href="https://developers.google.com/maps/documentation/webservices/?hl=nl">Google Maps API</a>
                </li>
                <li>
                  build cool apps with <a href="https://data.stad.gent/">Open Data Portaal Ghent</a>
                </li>
              </ul>
            </li>
            <li>
              Benefits from <strong>offering</strong> a web API:
              <ul class="v-style">
                <li>
                  make your products information available for price aggregators
                </li>
                <li>
                  split your huge application in smaller independent components
                </li>
                <li>
                  see how people build cool stuff with your data
                </li>
              </ul>
            </li>
          </ul>

        </section>
        <section data-toc-title="">
          <h2>Using Web API's</h2>
          <ul>
            <li>
              To use web API's, you basically need to answer the following questions:
              <ol>
                <li>how can we send an API request from the client to the server?</li>
                <li>how can we create a web API that handles the requests and sends back responses?</li>
                <li>what format will the response have, and how can we interprete its content?</li>
                <li>finally: how can we consume a web API in Javascript?</li>
              </ol>
            </li>
          </ul>
        </section>
        <section>
          <h2>1. Sending a request</h2>
          <ul>
            <li>
              We'll basically use HTTP(S) to send a request, just like a web page URL. Only instead of an HTML page, we'll get back a plain text response, usually in JSON or XML format. 
            </li>
            <li>
              To get an idea, just a few quick examples from the <a href="https://dog.ceo/dog-api/documentation/">Dog API</a>:
              <ul>
                <li>get a random image: <a href="https://dog.ceo/api/breed/hound/images/random">https://dog.ceo/api/breed/hound/images/random</a></li>
                <li>get a list of sub-breeds of the Retriever: <a href="https://dog.ceo/api/breed/retriever/list">https://dog.ceo/api/breed/retriever/list</a></li>
              </ul>
              An example from <a href="https://www.flickr.com/services/api/">Flickr API</a>:
              <ul>
                <li>search for images by tag: <a href="https://api.flickr.com/services/rest/?method=flickr.photos.search&extras=url_m&per_page=20&api_key=6ecfcd8d4a3b8a04da6093733db989a2&text=atomium">https://api.flickr.com/services/rest/?method=flickr.photos.search&extras=url_m&per_page=20&text=atomium&api_key=6ecfc...</a></li>
              </ul>
            </li>
          </ul>
        </section>
        <section>
          <h2>2. Handling the request</h2>
          <ul>
            <li>
              The next question, how to create a web API on the server that handles the request and sends a response, is an easy one: in this course, we won't care. We'll consider it a black box. 
            </li>
            <li>
              The web API can be any script on the server, written in any language (.NET, PHP, Ruby...), as long as it
              <ul>
                <li>accepts a HTTP request (GET or POST)</li>
                <li>sends back understandable text (usually XML or JSON) and a status code</li>
              </ul>
            </li>
            <li>
              If you're interested in how an API is actually built, continue reading; if not, skip to <a href="#/3-the-response">3. The response</a>
            </li>
          </ul>
        </section>
        <section>
          <h2 style="white-space: nowrap;">2. Building the API &mdash; URL design</h2>
          <ul>
            <li>
              Let's take a simple example: an API for managing your friends list. 
            </li>
            <li>
              First, we'll have to decide what the API URL's look like; the <em>URL design</em>. Assuming we host our API on https://bitmatters.be/o/friends-api/, we propose the following structure:
              <ul>
                <li><a href="https://bitmatters.be/o/friends-api/api.php?all">https://bitmatters.be/o/friends-api/api.php?all</a>: get all friends</li>
                <li><a href="https://bitmatters.be/o/friends-api/api.php?id=2">https://bitmatters.be/o/friends-api/api.php?id=2</a>: get friend by id</li>
                <li><a href="https://bitmatters.be/o/friends-api/api.php?delete=2">https://bitmatters.be/o/friends-api/api.php?delete=1</a>: delete friend by id</li>
              </ul>
            </li>
          </ul>
        </section>
        <section>
          <h2>2. Building the API &mdash; CSV</h2>
          <ul>
            <li>
              Next we need a place to store our  friends data.
            </li>
            <li>
              To not further complicate matters, we'll use a simple CSV file instead of a database. It contains a list of friends (id, name, age, email):
              <pre class="bigger"><code contenteditable class="language-php" data-caption="friends.csv">1,Rogier van der Linde,42,rogier.vanderlinde@odisee.be
2,Bram Van Damme,33,bram.vandamme@odisee.be
3,Davy De Winne,30,davy.dewinne@odisee.be
4,Hans Gruyaert,37,hansgruyaert@telenet.be
5,Dieter Roseeuw,38,dieter@pandora.be</code></pre>
              <div class="demolink"><a href="demos/05_api_ajax/friends.csv">friends.csv</a></div>
            </li>
          </ul>
        </section>
        <section>
          <h2>2. Building the API &mdash; PHP script</h2>
          <ul>
            <li>
              The final step is writing the server script that accepts the URL requests, and sends back responses. The full code listing:
              <pre class="bigger"><code contenteditable class="language-php" style="max-height: 250px">&lt;?php

  // tell the server to use JSON for output
  header('Content-type: application/json'); 

  // accept requests from other domains
  header('Access-Control-Allow-Origin: *'); 

  // path to CSV file
  define('CSV', 'friends.csv');

  // read CSV
  $friendsvals = file(CSV);
  $friends = array();
  foreach ($friendsvals as $friendvals) {
    $vals = explode(',', trim($friendvals));
    $friends[] = array('id' => (int) $vals[0], 'name' => $vals[1], 'age' => (int) $vals[2], 'email' => $vals[3]);
  }

  // returns friend by id
  function getFriendById($friends, $id) {
    foreach ($friends as $friend) {
      if ($friend['id'] == $id) return $friend;
    }
    return null;
  }

  // deletes friend by id
  function deleteFriendById(&$friends, $id) {
    for ($i = 0; $i < count($friends); $i++) {
      if ($friends[$i]['id'] == $id) {
        array_splice($friends, $i, 1);
        return true;
      } 
    }
    return false;
  }

  // writes friends to csv
  function writeToCsv($friends) {
    $csv = array();
    foreach ($friends as $friend) {
      $csv[] = implode(',', array_values($friend));
    }
    file_put_contents(CSV, implode(PHP_EOL, $csv));
  }

  // handle GET, all friends
  if (isset($_GET['all'])) {
    echo json_encode($friends);
    exit(0);
  }

  // handle GET, single friend
  if (isset($_GET['id'])) {
    $friend = getFriendById($friends, $_GET['id']);
    if ($friend == null) {
      http_response_code(404);
    } else {
      echo json_encode($friend);
    }
    exit(0);
  }

  // handle POST
  if ($_SERVER['REQUEST_METHOD'] == 'POST') {
    // decode incoming JSON
    $friend = json_decode(file_get_contents('php://input'), true);

    // bad request
    if (!isset($friend['name']) || !isset($friend['age']) || !isset($friend['email'])) {
      http_response_code(400);
      exit(0);
    } 

    // find new id
    $id = count($friends) == 0 ? 1 : (int) $friends[count($friends) - 1]['id'] + 1;

    // build new friend
    $friends[] = array('id' => $id, 'name' => $friend['name'], 'age' => $friend['age'], 'email' => $friend['email']);

    // write to csv
    writeToCsv($friends);

    // exit 
    exit(0);
  }

  // handle DELETE; because PHP has no DELETE superglobal, we use GET instead
  if (isset($_GET['delete'])) {
    // try to delete friend
    if (!deleteFriendById($friends, $_GET['delete'])) {
      http_response_code(404);
    } else {
      writeToCsv($friends);
    }

    // exit 
    exit(0);
  }

// EOF</code></pre>
              <div class="demolink"><a href="demos/05_api_ajax/api_json.php?all">demo</a></div>
            </li>
            <li class="smaller arrow">
              That's it! We have something that accepts a request, and outputs a JSON response. Easy, huh? A great tool for testing is the <a href="https://chrome.google.com/webstore/detail/postman-rest-client/fdmmgilgnpjigdojojpjoooidkmcomcm">Chrome Postman plugin</a>.
            </li>
          </ul>

        </section>
        <section>
          <h2>3. The response</h2>
          <ul>
            <li>
              You can inspect the request and response of an API request (like from all resources) in the DevTools network tab. It contains request information:
              <ul>
                <li>Request URL</li>
                <li>Request parameters</li>
                <li>Request method (GET, POST...)</li>
              </ul>
            </li>
            <li class="no-style">
              and also response information:
              <ul>
                <li>Status code</li>
                <li>Response type (XML, JSON, plain text...)</li>
                <li>Raw response data</li>
              </ul>              
            </li>
          </ul>
          <img src="img/05_api_ajax/network-tab.png" style="position: absolute;right: 20px; bottom: 20px; max-width: 40%; border: 1px solid #999">
        </section>
        <section>
          <h2>3. The response &mdash; status codes</h2>
          <ul>
            <li>
              Each response gets a status code; some examples:
              <ul>
                <li>200 - get ok</li>
                <li>201 - create ok</li>
                <li>301 - permanently moved</li>
                <li>400 - bad request (missing parameters)</li>
                <li>401 - not authorized (e.g. API key not given)</li>
                <li>404 - requested data not found</li>
                <li>405 - method not allowed (e.g. wrong verb)</li>
                <li>500 - internal server error</li>
              </ul>
            </li>
          </ul>
        </section>
        <section>
          <h2>3. The response &mdash; type</h2>
          <ul>
            <li>
              The response is just plain text. The way it should be interpreted is called the <em>response type</em>. It can be anything the server likes, but the most used are <em>XML</em> and <em>JSON</em>.
            </li>
            <li>
              E.g. Flickr returns XML by default; try <a style="font-size:smaller" href="https://api.flickr.com/services/rest/?method=flickr.photos.search&amp;text=atomium&amp;extras=url_m&amp;per_page=5&amp;api_key=6ecfcd8d4a3b8a04da6093733db989a2">https://api.flickr.com/.../?method=flickr.photos .search&amp;text=atomium&amp;extras=url_m &amp;per_page=5&amp;api_key=6ecfcd...</a>
              <pre class="bigger"><code contenteditable class="language-html" style="height: 250px">&lt;rsp stat="ok"&gt;
&lt;photos page="1" pages="2128217" perpage="5" total="10641084"&gt;
  &lt;photo id="8258910521" owner="28493557@N00" secret="88233d7d75" server="8502" farm="9"
    title="la cafeter√≠a" ispublic="1" isfriend="0" isfamily="0"
    url_m="http://farm9.staticflickr.com/8502/8258910521_88233d7d75.jpg" height_m="500" width_m="281"/&gt;
  &lt;photo id="8259983104" owner="49322283@N03" secret="a7bb4bd94b" server="8077" farm="9"
    title="Las Vegas strip" ispublic="1" isfriend="0" isfamily="0"
    url_m="http://farm9.staticflickr.com/8077/8259983104_a7bb4bd94b.jpg" height_m="500" width_m="332"/&gt;
  &lt;photo id="8258877609" owner="12811438@N08" secret="280988f53b" server="8355" farm="9"
    title="Carved German relief" ispublic="1" isfriend="0" isfamily="0"
    url_m="http://farm9.staticflickr.com/8355/8258877609_280988f53b.jpg" height_m="375" width_m="500"/&gt;
  &lt;photo id="8258885865" owner="12811438@N08" secret="3ca4569d2a" server="8061" farm="9"
    title="The Lady and the Unicorn" ispublic="1" isfriend="0" isfamily="0"
    url_m="http://farm9.staticflickr.com/8061/8258885865_3ca4569d2a.jpg" height_m="375" width_m="500"/&gt;
  &lt;photo id="8259949322" owner="12811438@N08" secret="1ceaa9fc1d" server="8218" farm="9"
    title="DSC00273" ispublic="1" isfriend="0" isfamily="0"
    url_m="http://farm9.staticflickr.com/8218/8259949322_1ceaa9fc1d.jpg" height_m="375" width_m="500"/&gt;
&lt;/photos&gt;
&lt;/rsp&gt;</code></pre>
            </li>
            <li class="no-style smaller">
              &rarr; note that Flickr requires an API key; <a href="https://www.flickr.com/services/api/misc.api_keys.html">get yours here</a> for free
            </li>
          </ul>
        </section>
        <section>
          <h2>3. The response &mdash; JSON</h2>
          <ul>
            <li>
              JSON is most used. You can get JSON from Flickr by adding a parameter <code style="font-size: smaller;">format</code>: <a style="font-size:smaller" href="https://api.flickr.com/services/rest/?method=flickr.photos.search&amp;text=atomium&amp;extras=url_m&amp;per_page=5&amp;api_key=6ecfcd8d4a3b8a04da6093733db989a2&amp;format=json">https://api.flickr.com/services/rest/?method=flickr.photos.search &amp;text=atomium&amp;extras=url_m &amp;per_page=5&amp;api_key=6ecfcd...<span style="color: #900">&amp;format=json</span></a>
              <pre class="bigger"><code contenteditable class="language-js" style="height: 250px">{"photos":{"page":1, "pages":2130468, "perpage":5, "total":"10652338", "photo":[{"id":"8258970061",
"owner":"57683823@N07", "secret":"cd82c94425", "server":"8215", "farm":9, "title":"Alsatian Choucroute
at Maison d'Alsace in Paris.", "ispublic":1, "isfriend":0, "isfamily":0, "url_m":"http:\/\
/farm9.staticflickr.com\/8215\/8258970061_cd82c94425.jpg", "height_m":"375", "width_m":"500"},
{"id":"8258965669", "owner":"90915031@N08", "secret":"0f57778c48", "server":"8361", "farm":9,
"title":"Perth sights", "ispublic":1, "isfriend":0, "isfamily":0, "url_m":"http:\/\
farm9.staticflickr.com\/8361\/8258965669_0f57778c48.jpg", "height_m":"500", "width_m":"375"}, {"id":"8258925755",
"owner":"82551583@N00", "secret":"255dcf2c8a", "server":"8064", "farm":9, "title":"Mus\u00e9e du Louvre HDRI",
"ispublic":1, "isfriend":0, "isfamily":0, "url_m":"http:\/\/farm9.staticflickr.com\/8064\/8258925755_255dcf2c8a.jpg",
"height_m":"333", "width_m":"500"}, {"id":"8259990066", "owner":"30981722@N00", "secret":"1894ba5fb9",
"server":"8477", "farm":9, "title":"dandelion lights @ Design Miami", "ispublic":1, "isfriend":0, "isfamily":0,
"url_m":"http:\/\/farm9.staticflickr.com\/8477\/8259990066_1894ba5fb9.jpg", "height_m":"500", "width_m":"375"},
{"id":"8258910521", "owner":"28493557@N00", "secret":"88233d7d75", "server":"8502", "farm":9,
"title":"lacafeter\u00eda", "ispublic":1, "isfriend":0, "isfamily":0, "url_m":"http:\/\
farm9.staticflickr.com\/8502\/8258910521_88233d7d75.jpg", "height_m":"500", "width_m":"281"}]}, "stat":"ok"}</code></pre>
            </li>
            <li class="arrow smaller">
              what is this 'JSON' format?
            </li>
          </ul>
        </section>
        <section>
          <h2>3. The response &mdash; JSON</h2>
          <ul>
            <li>
              <em>JSON</em> (Javascript Object Notation) is a string representation of a single Javascript object holding all information.
            </li>
            <li>
              An example JSON string is  <code style="font-size: smaller">{"course":"RIA","lecturers":[{"id":1,"name":"Davy De Winne"},{"id": 2,"name": "Bramus Van Damme"}]}</code>, or in a more readable layout (use <a href="https://jsonformatter.curiousconcept.com/">this beautifier</a>):
              <pre class="bigger"><code contenteditable class="language-javascript">{
  "course": "RIA",
  "lecturers": [
    {
      "id": 1,
      "name": "Davy De Winne"
    },
    {
      "id": 2,
      "name": "Bramus Van Damme"
    }
  ]
}</code></pre>
            </li>
          </ul>
        </section>
        <section>
          <h2>3. The response &mdash; JSON FTW!</h2>
          <ul>
            <li>
              Keys are <code>string</code> (double quotes required!), values may be <code>string</code>, <code>number</code>, <code>Object</code>, <code>Array</code>, <code>boolean</code> or <code>null</code>.
            </li>
            <li>
              Well supported in almost all programming languages (PHP functions <code>json_encode()</code>/<code>json_decode()</code>, Javascript functions <code>JSON.parse()</code>/<code>JSON.stringify()</code> )
            </li>
            <li>
              JSON FTW!
              <ul>
                <li>easy to work with (clientside and serverside)</li>
                <li>less overhead than XML</li>
                <li>supported by all modern web API's</li>
              </ul>
            </li>
          </ul>
        </section>
      </section>
      <section>
        <section>
          <h1>API's &amp; Ajax</h1>
          <h2>AJAX</h2>
          <ul class="chapterlist">
            <!-- to be filled by Javascript -->
          </ul>
        </section>
        <section>
          <h2>About AJAX</h2>
          <ul>
            <li>
              Now let's solve our last question: how can we consume a web API with Javascript? How can we request an URL without reloading the page?
            </li>
            <li>
              The technique used is called <em>AJAX</em>:
              <ul>
                <li>Asynchronous Javascript and XML</li>
                <li>allows requests to a web server without leaving the page</li>
                <li>originally created by developers of Outlook Web Access (Microsoft) back in 2000, later picked up by Google in Google suggest</li>
                <li>at the core sits the <code>XMLHttpRequest</code> object</li>
              </ul>
            </li>
          </ul>
        </section>
        <section>
          <h2>Synchronous example</h2>
          <pre class="bigger"><code contenteditable class="language-javascript overlayrun wrong">let xhr = new XMLHttpRequest();
xhr.open('GET', 'demos/05_api_ajax/api_json.php?id=2', false);
xhr.send();
alert(xhr.responseText);</code></pre>
          <ul>
            <li class="no-style smaller">
              &rarr; synchronous calls block the UI while waiting for a response<br />
              &rarr; never use synchronous AJAX calls
            </li>
          </ul>

        </section>
        <section>
          <h2>Asynchronous example</h2>
          <pre class="bigger"><code contenteditable class="language-javascript overlayrun right">let xhr = new XMLHttpRequest();
xhr.addEventListener('readystatechange', function() {
  if (this.readyState == 4 && this.status == 200) {
    alert(this.responseText);
  }
});
xhr.open('GET', 'demos/05_api_ajax/api_json.php?id=2', false);
xhr.send();</code></pre>
        </section>
        <section data-toc-title="AJAX Flickr demo">
          <h2>AJAX Flickr demo (1)</h2>
          <ul>
            <li>
              Let's build a small application using the Flickr API. HTML...
              <pre class="bigger"><code class="language-html">&lt;!DOCTYPE html&gt;
&lt;head&gt;
  &lt;title&gt;Ajax example&lt;/title&gt;
  &lt;meta charset="utf-8"&gt;
  &lt;style&gt;
    #pics img {
      height: 200px;
      display: block;
      margin-top: 20px;
      margin-right: 20px;
      float: left;
    }
  &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
  &lt;input id="search" type="text" placeholder="search here" /&gt;
  &lt;div id="pics"&gt;&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
            </li>
          </ul>
        </section>
        <section data-toc-title="">
          <h2>AJAX Flickr demo (2)</h2>
          <ul>
            <li>
              ...and the Javascript:
              <pre class="bigger"><code class="language-javascript">window.addEventListener('load', function() {

  var pics = document.getElementById('pics');
  var search = document.getElementById('search');

  search.addEventListener('keypress', function(e) {
    if (e.which == 13) {
      pics.innerHTML = '';
      makeSearch(this.value);
    }
  });

  var xhr = new XMLHttpRequest();

  xhr.onreadystatechange = function(e) {
    var data = JSON.parse(this.responseText);
    data = data.photos.photo;
    for (var i = 0; i &lt; data.length; i++) {
      var img = document.createElement('img');
      img.setAttribute('src', data[i].url_m);
      pics.appendChild(img);
    }
  };

  var makeSearch = function (value) {
    var url = "https://api.flickr.com/services/rest/?method=flickr.photos.search&amp;extras=url_m&amp;per_page=20&amp;format=json&amp;nojsoncallback=1&amp;safe_search=1";
    url += '&amp;api_key=6ecfcd8d4a3b8a04da6093733db989a2';
    url += '&amp;text=' + value;
    url = encodeURI(url);
    xhr.open("GET", url, true);
    xhr.send()
  };

});
</code></pre>
              <div class="demolink"><a href="demos/05_api_ajax/flickr.html">demo</a></div>
            </li>
          </ul>
        </section>
        <section data-toc-title="Fetch API">
          <h2>Fetch API (1)</h2>
          <ul>
            <li>
              The Javascript code isn't very easy to read, and we also need to handle errors etc... Comes in the new <a href="https://developers.google.com/web/updates/2015/03/introduction-to-fetch">Javascript Fetch API</a>, created as a flexible and easy solution to perform AJAX requests. The basic syntax:
              <pre class="bigger"><code class="language-javascript">function handleError(err) {
    console.log('Request failed', err)
}
function handleResponse(resp) {
  console.log('response status: ', resp.status);
  return resp.json();
}
function handleSuccess(data) {
  console.log('data received: ', data);
}
let url = ...;  // insert request URL here
fetch(url)
    .then(handleResponse)
    .then(handleSuccess)
    .catch(handleError);
</code></pre>
            </li>
          </ul>
        </section>
        <section data-toc-title="">
          <h2>Fetch API (2)</h2>
          <ul>
            <li>
              The AJAX Flickr demo, using the Fetch API (and also conveniently using the <a href="https://developer.mozilla.org/en-US/docs/Web/API/URLSearchParams">URLSearchParams</a> URL API):
              <pre class="bigger"><code class="language-javascript">window.addEventListener('load', function() {

  let  pics = document.getElementById('pics');
  let  search = document.getElementById('search');

  search.onkeypress = function(e) {
    if (e.which == 13) {
      pics.innerHTML = '';
      makeSearch(this.value);
    }
  }

  function onError(error) {
    console.log('Request failed', error)
  }

  function onResponse(res) {
    // error
    if (res.status < 200 || res.status >= 300) {
      console.log('error with status ' + res.status);
    } else {
      console.log('response ok ' + res.status);
      return res.json();
    }
  }

  function onSuccess(data) {
    // all ok
    for (let  i = 0; i < data.photos.photo.length; i++) {
      let  img = document.createElement('img');
      if (data.photos.photo[i].url_m) img.setAttribute('src', data.photos.photo[i].url_m);
      pics.appendChild(img);
    }
  }

  function makeSearch(value) {
    let base = "https://api.flickr.com/services/rest2/?";
    let params = "method=flickr.photos.search&extras=url_m&per_page=20&format=json&nojsoncallback=1&safe_search=1";
    let searchParams = new URLSearchParams(params);
    searchParams.append('api_key', '6ecfcd8d4a3b8a04da6093733db989a2')
    searchParams.append('text', value);
    let url = base + searchParams.toString();
    fetch(url)
      .then(onResponse)
      .then(onSuccess)
      .catch(onError);
  }
});
</code></pre>
              <div class="demolink"><a href="demos/05_api_ajax/flickr_fetch.html">demo</a></div>
            </li>
          </ul>
        </section>
        <section>
          <h2>Things to consider</h2>
          <ul>
            <li>
              AJAX is essential in modern web development:
              <ul>
                <li>no reloads</li>
                <li>faster</li>
                <li>less bandwith used</li>
              </ul>
            </li>
            <li>
              But beware:
              <ul>
                <li>no browser history, back button is broken, no bookmarking</li>
                <li>search engines do not index injected content</li>
              </ul>
            </li>
          </ul>
        </section>
      </section>

      <section data-index-title="">
        <section>
          <h2>Questions?</h2>
        </section>
      </section>

    </div>

    <!-- odisee.be link -->
    <a href="http://www.odisee.be/" title="odisee.be" id="odisee"><img src="img/odisee.png" alt="Odisee logo"></a>


    <!-- Index Link -->
    <aside class="back">
      <nav>
        <p><a href="index.html">&larr; Back to index</a></p>
      </nav>
    </aside>

  </div>

  <script src="vendor/jquery.min.js"></script>
  <script src="vendor/reveal/lib/js/head.min.js"></script>
  <script src="vendor/reveal/js/reveal.js"></script>
  <script src="vendor/highlight/highlight.pack.js"></script>
  <script src="vendor/incrementable.js"></script>
  <script src="vendor/prefixfree.js"></script>
  <script src="vendor/css-snippets.js"></script>
  <script src="vendor/css-edit.js"></script>
  <script src="js/main.js"></script>
  <script>
    var devtools = /./;
      devtools.toString = function() {
      this.opened = true;
    }
    console.log('%c', devtools);
    if (!devtools.opened) {
//      alert('some demos show their results in the console, so keep it open (press F12 or Shift-Ctrl-I)');
    }
  </script>

</body>
</html>
