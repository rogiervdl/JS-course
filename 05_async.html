<!DOCTYPE html>
<!-- [html-validate-disable no-trailing-whitespace] -->
<html lang="nl">

<head>
   <title>Web API's | Javascript cursus</title>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <link rel="stylesheet" href="common/styles.css">
   <link rel="stylesheet" href="css/styles.css">
</head>

<body class="language-javascript">
   <div id="mode">
      <span>n00b</span>
      <label class="switch">
         <input type="checkbox" checked>
         <span class="slider round"></span>
      </label>
      <span>pro</span>
   </div>
   <nav class="site__nav">
      <a href="01_syntax.html" class="main__thumb" title="01. Javascript syntax">
         <p class="thumb__title">01. Javascript syntax</p>
         <img class="thumb__visual" src="img/01_syntax/icon.png" alt="">
      </a>
      <a href="02_domhtml.html" class="main__thumb" title="02. HTML manipulatie">
         <p class="thumb__title">02. HTML manipulatie</p>
         <img class="thumb__visual" src="img/02_domhtml/icon.png" alt="">
      </a>
      <a href="03_domcss.html" class="main__thumb" title="03. CSS manipulatie">
         <p class="thumb__title">03. CSS manipulatie</p>
         <img class="thumb__visual" src="img/03_domcss/icon.png" alt="">
      </a>
      <a href="04_games.html" class="main__thumb" title="04. Games">
         <p class="thumb__title">04. Games</p>
         <img class="thumb__visual" src="img/04_games/icon.png" alt="">
      </a>
      <a href="05_async.html" class="main__thumb active" title="05. Web API's">
         <p class="thumb__title">05. Web API's</p>
         <img class="thumb__visual" src="img/05_async/icon.png" alt="">
      </a>
      <a href="06_nodejs.html" class="main__thumb pro" title="06. NodeJS">
         <p class="thumb__title">06. NodeJS</p>
         <img class="thumb__visual" src="img/06_nodejs/icon.png" alt="">
      </a>
      <a href="es6.html" class="main__thumb pro" title="ES6">
         <p class="thumb__title">ES6</p>
         <img class="thumb__visual" src="img/es6/icon.png" alt="">
      </a>
      <a href="summary.html" class="main__thumb" title="05. samenvatting">
         <p class="thumb__title">samenvatting</p>
         <img class="thumb__visual" src="img/summary/icon.png" alt="">
      </a>
   </nav>
   <h1>05. Web API's</h1>
   <div id="toc"></div>
   <p class="othercourses"><small>Dit hoofdstuk is onderdeel van de cursus <a href="https://rogiervdl.github.io/JS-course/">Javascript</a>. Andere cursussen in dezelfde reeks: <a href="https://rogiervdl.github.io/HTML-course/">HTML</a>, <a href="https://rogiervdl.github.io/CSS-course/">CSS</a>, <a href="https://rogiervdl.github.io/CS-course/">C#</a>, <a href="https://rogiervdl.github.io/DEVENV-course/">Ontwikkelomgeving</a>.</small></p>
   <main>
      <!-- VIDEO -->
      <h2>On Youtube: Web API's</h2>
      <div class="flexcontainer youtubecontainer">
         <iframe class="youtube" width="600" height="378" src="https://www.youtube.com/embed/4OFHIhSFNgI" title="YouTube video player" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
         <figure class="print">
            <a href="https://www.youtube.com/embed/4OFHIhSFNgI"><img src="img/05_async/04.DWD-api.png" alt="" class="w-500"></a>
            <figcaption><a href="https://www.youtube.com/embed/4OFHIhSFNgI">https://www.youtube.com/embed/4OFHIhSFNgI</a></figcaption>
         </figure>
         <div class="youtube_toc">
            <ul>
               <li><a href="https://www.youtube.com/watch?v=4OFHIhSFNgI&t=0s">00:00 intro</a></li>
               <li><a href="https://www.youtube.com/watch?v=4OFHIhSFNgI&t=535s">08:55 Dog API (request/responsie, fetch, JSON)</a></li>
               <li><a href="https://www.youtube.com/watch?v=4OFHIhSFNgI&t=1690s">28:10 Flickr API (API key, request parameters met URLSearchParams)</a></li>
               <li><a href="https://www.youtube.com/watch?v=4OFHIhSFNgI&t=2632s">43:52 Github API (request headers, access token)</a></li>
               <li><a href="https://www.youtube.com/watch?v=4OFHIhSFNgI&t=2879s">47:59 RapidAP (async/await, requests chainen)</a></li>
            </ul>
         </div>
      </div>
      <h2>Over web API's</h2>
      <h3>Wat is een web API</h3>
      <p>
         Algemeen in programmeren is een <mark>API</mark> of <strong>Application Programming Interface</strong>, een
         <strong>set van methodes</strong> die je als developer kan gebruiken om <strong>informatie uit te wisselen</strong> met jouw toepassing.
      </p>
      <p>
         Een <mark>Web API</mark> is hetzelfde maar dan op het web, dus een dienst die je kan integreren in jouw
         webtoepassing. Denk aan:
      </p>
      <ul>
         <li>opvragen van de <strong>laatste Twitter tweets</strong> rond een bepaald onderwerp</li>
         <li>integratie <strong>Google ads</strong> in je website</li>
         <li>gebruik <strong>route-informatie</strong> van Google Maps (b.v. afstanden)</li>
         <li><strong>random quotes</strong> opvragen van een random quote generator</li>
         <li><strong>machine learning &amp; AI</strong>, bv. tekst- of fotoherkenning</li>
         <li><strong>weather service</strong> gebruiken</li>
         <li><strong>sportuitslagen</strong> opvragen</li>
         <li>...</li>
      </ul>
      <h3>Web API's vinden</h3>
      <p>
         Er zijn massa's dergelijke API's te vinden!
         Bijna alle grote webtoepassingen als <a href="https://developers.google.com/youtube/v3">Youtube</a>,
         <a href="https://developers.google.com/maps">Google Maps</a>,
         <a href="https://www.dropbox.com/developers/documentation/http/documentation">Dropbox</a>,
         <a href="https://developer.twitter.com/en/docs/twitter-api">Twitter</a>,
         <a href="https://www.flickr.com/services/api/">Flickr</a> enz... hebben er één (zoek via google, bv. "Flickr
         API"). Kleinere (en vaak makkelijker te gebruiken) API's bestaan ook: weather service, random quotes...
      </p>
      <figure>
         <img src="img/05_async/flickr-docs.png" alt="" class="w-500">
         <figcaption>Flickr API documentatie</figcaption>
      </figure>
      <p>
         <a href="https://rapidapi.com/marketplace">RapidAPI</a> heeft een uitgebreide collectie op haar website, en je
         hoeft maar één keer te registreren:
      </p>
      <figure>
         <img src="img/05_async/rapid-docs.png" alt="" class="w-500">
         <figcaption>overzicht API's op rapidapi.com</figcaption>
      </figure>
      <h3>Web API's gebruiken</h3>
      <p>
         Hoe je een Web API moet gebruiken varieert enorm, van heel eenvoudig tot zeer moeilijk. Enkele aspecten om
         rekening mee te houden:
      </p>
      <ul class="arrow">
         <li>
            <strong>wat biedt de API?</strong>
            <ul>
               <li>welke informatie, welke <strong>methodes en parameters</strong> zijn beschikbaar?</li>
               <li>hoe goed is de <strong>documentatie</strong> (vaak een zwak punt)?</li>
               <li>welke <strong>formaten</strong> worden gebruikt voor de request en response informatie?</li>
            </ul>
         </li>
         <li>
            <strong>hoe verloopt de authenticatie?</strong>
            <ul>
               <li>volledig <strong>open</strong> (geen authenticatie nodig) &rarr; super simpel; komt minder en minder
                  voor</li>
               <li>registratie nodig; je krijgt een <strong>API key of token</strong> die je met elke request moet
                  meesturen &rarr; goed te doen</li>
               <li>registratie nodig; <strong>complexe authenticatiemethodes</strong> als OAuth &rarr; te moeilijk voor
                  deze cursus</li>
            </ul>
         </li>
         <li>
            <strong>wat zijn de prijzen/quota?</strong>
            <ul>
               <li>volledig <strong>gratis</strong> en zonder limieten &rarr; komt minder en minder voor</li>
               <li>gratis maar <strong>gelimiteerd</strong>, bv. dagelijkse / maandelijkse quota gelinkt aan de API key
                  &rarr; kunnen we gebruiken</li>
               <li><strong>betalend</strong>, bv. een vast bedrag per request &rarr; geen optie voor deze cursus </li>
            </ul>
         </li>
      </ul>
      <h2>Dog API voorbeeld: open API, geen API key</h2>
      <p>
         Een API waar geen registratie of key voor nodig is, heet een <mark>open API</mark>. Er is geen enkele controle
         of limiet op het gebruik. Een voorbeeld is de <a href="https://dog.ceo/dog-api/documentation/">Dog API</a>,
         waar je informatie kan vinden over honden:
      </p>
      <ul class="arrow">
         <li>lijst van alle hondenrassen</li>
         <li>een random foto</li>
         <li>foto's van een specifiek hondenras</li>
         <li>...</li>
      </ul>
      <h3>documentatie</h3>
      <figure>
         <img src="img/05_async/dog-api.png" alt="" class="w-600">
         <figcaption>dog API documentatie</figcaption>
      </figure>
      <p>
         Zoals je ziet in de documentatie, bestaat deze eenvoudige API uit een <strong>set URL's</strong> waarmee je
         informatie kan opvragen, bv.
         <br><a href="https://dog.ceo/api/breeds/list/all">https://dog.ceo/api/breeds/list/all</a>
         <br><a href="https://dog.ceo/api/breeds/image/random">https://dog.ceo/api/breeds/image/random</a>
         <br><a href="https://dog.ceo/api/breed/schnauzer/images">https://dog.ceo/api/breed/schnauzer/images</a>
      </p>
      <h3>request en response</h3>
      <p>
         Vragen we bijvoorbeeld via <a href="https://dog.ceo/api/breed/hound/images/random/5">https://dog.ceo/api/breed/hound/images/random/5</a>
         vijf random foto's op van het ras "hound" (de <mark>request</mark>), dan krijg je volgende informatie terug (de
         <mark>response</mark>):
      </p>
      <figure>
         <img src="img/05_async/dog-api-request.png" alt="" class="w-600">
         <figcaption>API request (cfr. adresbalk) en response</figcaption>
      </figure>
      <ul class="arrow">
         <li>de response is geen HTML, maar <mark>JSON</mark> (<mark>Javascript Object Notation</mark>)</li>
         <li>er bestaan andere response formaten (XML, SOAP, CSV...) maar dit formaat is het meest gebruikt bij API's</li>
      </ul>
      <h3>JSON</h3>
      <p><mark>JSON</mark> of <strong>Javascript Object Notation</strong> is technisch gezien de notatie van een object in Javascript</p>
      <pre class="prism-okaida language-json line-numbers w-700 padtop" data-caption="JSON"><code>{"message":["https:\/\/images.dog.ceo\/breeds\/hound-afghan\/n02088094_2292.jpg","https:\/\/images.dog.ceo\/breeds\/hound-blood\/n02088466_7091.jpg","https:\/\/images.dog.ceo\/breeds\/hound-blood\/n02088466_7609.jpg","https:\/\/images.dog.ceo\/breeds\/hound-english\/n02089973_208.jpg","https:\/\/images.dog.ceo\/breeds\/hound-ibizan\/n02091244_2820.jpg"],"status":"success"}</code></pre>
      <p>Je zou de response zelfs kunnen kopiëren in een Javascript variabele en gebruiken in je pagina:</p>
      <pre class="prism-okaida line-numbers w-700" data-caption><code>const data = {
   message: [
      'https://images.dog.ceo/breeds/hound-afghan/n02088094_2292.jpg',
      'https://images.dog.ceo/breeds/hound-blood/n02088466_7091.jpg',
      'https://images.dog.ceo/breeds/hound-blood/n02088466_7609.jpg',
      'https://images.dog.ceo/breeds/hound-english/n02089973_208.jpg',
      'https://images.dog.ceo/breeds/hound-ibizan/n02091244_2820.jpg'
   ],
   status: 'success'
}
</code></pre>
      <p>Verwerkt in een eenvoudige toepassing:</p>
      <div class="democontainer">
         <pre class="prism-default language-html line-numbers w-700" data-demo data-caption><code>&lt;button type="button" id="btnRandomDogs"&gt;FETCH DOGS&lt;/button&gt;
&lt;div id="dogs"&gt;&lt;/div&gt;</code></pre>
         <pre class="prism-atom-dark language-css line-numbers w-700" data-caption><code>img {
   margin: 10px;
   height: 200px;
}</code></pre>
         <pre class="prism-okaida line-numbers w-700" data-caption><code>// declaraties
const btnRandomDogs = document.querySelector('#btnRandomDogs');
const divDogs = document.querySelector('#dogs');

// functies
function fetchRandomDogs() {
   // data
   const data = {
      message: [
         'https://images.dog.ceo/breeds/hound-afghan/n02088094_2292.jpg',
         'https://images.dog.ceo/breeds/hound-blood/n02088466_7091.jpg',
         'https://images.dog.ceo/breeds/hound-blood/n02088466_7609.jpg',
         'https://images.dog.ceo/breeds/hound-english/n02089973_208.jpg',
         'https://images.dog.ceo/breeds/hound-ibizan/n02091244_2820.jpg'
      ],
      status: 'success'
   };

   // generate images
   if (data.status == 'success') {
      data.message.forEach(url =&gt; {
         const img = `&lt;img src="${url}" alt=""&gt;`;
         divDogs.innerHTML += img;
      });
   }
}

// events
btnRandomDogs.addEventListener('click', fetchRandomDogs);</code></pre>

      </div>
      <img src="img/05_async/dog-fetch2.png" alt="" class="w-600 bordered">

      <h3>toepassing 1: 5 random foto's ophalen</h3>
      <p>Met <code>fetch()</code> kan je zo'n URL <strong>dynamisch</strong> opvragen en de data gebruiken:</p>
      <div class="democontainer">
         <pre class="prism-default language-html line-numbers w-700" data-caption data-demo><code>&lt;button type="button" id="btnRandomDogs"&gt;FETCH DOGS&lt;/button&gt;
&lt;div id="dogs"&gt;&lt;/div&gt;</code></pre>
         <pre class="prism-atom-dark language-css line-numbers w-700" data-caption><code>img {
   margin: 10px;
   height: 200px;
}</code></pre>
         <pre class="prism-okaida line-numbers w-700" data-caption><code>// declarations
const btnRandomDogs = document.querySelector('#btnRandomDogs');
const divDogs = document.querySelector('#dogs');

// functions
async function fetchRandomDogs() {
   // build request
   const url = 'https://dog.ceo/api/breed/hound/images/random/5';

   // fetch data
   const resp = await fetch(url);
   if (!resp.ok) {
      console.log('opvragen random dogs mislukt');
      return;
   }
   const data = await resp.json();

   // process data
   data.message.forEach(url =&gt; {
      divDogs.innerHTML += `&lt;img src="${url}" alt=""&gt;`;
   });
}

// event handlers
async function handleBtnRandomDogsClick() {
   console.log('start feching dogs...');
   await fetchRandomDogs();
   console.log('...fetch finished');
}

// start fetching on click
btnRandomDogs.addEventListener('click', handleBtnRandomDogsClick);</code></pre>

      </div>
      <div class="tips" data-caption="💡 async/await">
         <p>
            De uitleg over async/await volgt later nog, maar kort gezegd betekent <mark>async</mark>:
            <strong>"dit kan even duren, doe alvast verder met de rest"</strong>, en <mark>await</mark>:
            <strong>"nee nee, ik wacht wel tot het resultaat binnen is"</strong>
         </p>
      </div>
      <figure>
         <img src="img/05_async/dog-fetch2.png" alt="" class="w-600 bordered">
         <figcaption>toepassing 1: gegevens worden dynamisch opgehaald</figcaption>
      </figure>
      <h3>toepassing 2: foto's van een specifiek ras ophalen </h3>
      <p>Een iets uitgebreider voorbeeld, waarbij eerst de hondenrassen opgehaald worden in een lijstje:</p>
      <div class="democontainer">
         <pre class="prism-default language-html line-numbers w-700" data-demo data-caption><code>&lt;select id="selBreeds" class="hide"&gt;&lt;/select&gt;
&lt;p id="parMessage"&gt;&nbsp;&lt;/p&gt;
&lt;div id="divImages"&gt;&lt;/div&gt;</code></pre>
         <pre class="prism-atom-dark language-css line-numbers w-700" data-caption><code>img {
   margin: 10px;
   height: 200px;
}</code></pre>
         <pre class="prism-okaida line-numbers w-700 h-600" data-caption><code>// declarations
const selBreeds = document.querySelector('#selBreeds');
const parMessage = document.querySelector('#parMessage');
const divImages = document.querySelector('#divImages');

// functions
async function fetchBreeds() {
   // build request
   const url = 'https://dog.ceo/api/breeds/list/all';

   // fetch data
   const resp = await fetch(url);
   const data = await resp.json();
   if (data.status != 'success') {
      console.log('fetching breeds failed');
      return;
   }

   // return list of breeds
   const breeds = data.message;
   return breeds;
}

async function populateBreedsList() {
   parMessage.innerHTML = 'fetching breeds...';
   const breeds = await fetchBreeds();
   selBreeds.innerHTML = `&lt;option value=""&gt;selecteer...`&lt;/option`&gt;`;
   for (const breed in breeds) {
      selBreeds.innerHTML += ``&lt;option&gt;${breed}`&lt;/option&gt;`;
   }
   selBreeds.classList.remove('hide');
   parMessage.innerHTML = 'done fetching breeds - select one from the list';
}

// event handlers
async function handleBreedSelection() {
   // build request
   parMessage.innerHTML = `fetching images for ${this.value}`;
   const url = `https://dog.ceo/api/breed/${this.value}/images`;

   // fetch data
   const resp = await fetch(url);
   const data = await resp.json();
   if (data.status != 'success') {
      console.log('fetching breeds failed');
      return;
   }

   // show photos
   divImages.innerHTML = '';
   data.message.forEach(src =&gt; {
      divImages.innerHTML += `&lt;img src="${src}" alt=""&gt;`;
   });
   parMessage.innerHTML = `done fetching images for ${this.value}!`;
}

// events
selBreeds.addEventListener('change', handleBreedSelection);

// start fetching breeds and populate list
populateBreedsList();</code></pre>
      </div>

      <figure>
         <img src="img/05_async/dog-fetch3.png" alt="" class="w-600 bordered">
         <figcaption>toepassing 2: eerste fetch() dient om het lijstje op te bouwen, tweede fetch() om foto's op te
            halen</figcaption>
      </figure>

      <h2>Flickr API voorbeeld: API key, request parameters</h2>
      <h3>API key aanvragen</h3>
      <p>
         Flickr is een foto community met een zeer <a href="https://www.flickr.com/services/api/">uitgebreide API</a>.
         Het verschil met het vorige voorbeeld is dat je (na <a href="https://identity.flickr.com/sign-up">registratie</a>) een <strong>API key</strong> moet aanvragen,
         en die meesturen met elke request. De key is <strong>gratis</strong>, maar het geeft hen, in tegenstelling tot
         open API's, wel een beetje <strong>controle op je verbruik</strong>.
      </p>
      <figure>
         <img src="img/05_async/flickr-registration.png" alt="" class="w-600">
         <figcaption>API key aanvraag bij Flickr.com</figcaption>
      </figure>
      <h3>documentatie</h3>
      <p>
         In de uitgebreide documentatie vinden we een methode <a href="https://www.flickr.com/services/api/flickr.photos.search.html">flickr.photos.search</a>, met alle mogelijke opties.
         Een aantal van deze opties zullen we meesturen als <strong>request parameters</strong>.
      </p>
      <img src="img/05_async/flickr-photosearch.png" alt="" class="w-600">
      <h3>toepassing: zoeken op foto's</h3>
      <p>Verwerkt in een eenvoudige toepassing:</p>
      <div class="democontainer">
         <pre class="prism-default language-html line-numbers w-800" data-caption data-demo="demos/05_async/demoFlickrAPI/index.html"><code>&lt;form action="" id="frmSearch"&gt;
   &lt;label&gt;
      search:
      &lt;input id="inpSearch" type="text" placeholder="enter keyword (.e.g. Eiffel)"&gt;
   &lt;/label&gt;
&lt;/form&gt;
&lt;div id="pics"&gt;&lt;/div&gt;</code></pre>
         <pre class="prism-atom-dark language-css line-numbers w-700" data-caption><code>#pics {
   display: flex;
   flex-flow: row wrap;
}
#pics img {
   height: 200px;
   display: block;
   margin-top: 20px;
   margin-right: 20px;
}
#search {
   width: 200px;
}</code></pre>
         <pre class="prism-okaida line-numbers w-700 h-600" data-caption><code>// inits
const pics = document.querySelector('#pics');
const frmSearch = document.querySelector('#frmSearch');
const inpSearch = frmSearch.querySelector('#inpSearch');
const API_KEY = '60dce28390e0a3...'; // vul je eigen key in!

// functions
async function makeSearch(searchval) {
   // build request
   let url = 'https://api.flickr.com/services/rest/';
   const params = new URLSearchParams();
   params.append('api_key', API_KEY);
   params.append('extras', 'url_m');
   params.append('format', 'json');
   params.append('method', 'flickr.photos.search');
   params.append('per_page', 20);
   params.append('nojsoncallback', 1);
   params.append('text', searchval);
   url += '?' + params.toString();

   // fetch data
   const resp = await fetch(url);
   if (!resp.ok) {
      console.log('opvragen foto\'s mislukt');
      return;
   }
   const data = await resp.json();

   // process data
   pics.innerHTML = '';
   data.photos.photo.forEach(photo =&gt; {
      pics.innerHTML += `&lt;img src="${photo.url_m}" alt=""&gt;`;
   });
}

// event handlers
async function handleSearch(e) {
   e.preventDefault();
   console.log('start fetching photos...');
   await makeSearch(inpSearch.value);
   console.log('...done!');
}

// search event
frmSearch.addEventListener('submit', handleSearch);</code></pre>
      </div>
      <figure>
         <img src="img/05_async/flickr-search.png" alt="" class="w-500 bordered">
         <figcaption>Flickr API demo</figcaption>
      </figure>

      <h2>Github API voorbeeld: token, request headers</h2>
      <h3>open gebruik &mdash; beperkt</h3>
      <p>Je kan in principe de Github API open gebruiken, zonder API key of token:</p>
      <div class="democontainer">
         <pre class="prism-default language-html line-numbers w-700" data-caption data-demo><code>&lt;ul id="lstRepos"&gt;&lt;/ul&gt;</code></pre>
         <pre class="prism-okaida line-numbers w-700" data-caption><code>// declaraties
const lstRepos = document.querySelector('#lstRepos');

// functies
async function getMyRepos() {
   // build request
   const username = 'rogiervdl';
   const url = `https://api.github.com/users/${username}/repos`;

   // fetch data
   const resp = await fetch(url);
   if (!resp.ok) {
      console.log('opvragen github repos mislukt');
      return;
   }
   const data = await resp.json();

   // return repos
   const repos = data;
   return repos;
}

async function doGetRepos() {
   console.log('fetching repos...');
   const repos = await getMyRepos();
   repos.forEach(repo =&gt; {
      lstRepos.innerHTML += `&lt;li&gt;
      &lt;a href="${repo.html_url}"&gt;${repo.full_name}&lt;/a&gt;
      &amp;mdash; ${repo.description}&lt;/li&gt;`;
   });
   console.log('...done');
}

// get repos
doGetRepos();</code></pre>
      </div>


      <figure>
         <img src="img/05_async/github-fetch1.png" alt="" class="w-500 bordered shadow">
         <figcaption>ophalen en weergeven repos via Github API</figcaption>
      </figure>
      <p>
         Het aantal requests is voor anonieme gebruikers echter standaard beperkt tot amper 60 per uur. Je kan het je
         kan het aantal resterende requests terugvinden in de response headers onder Network (klik links op de AJAX request):
      </p>
      <figure>
         <img src="img/05_async/github-limit1.png" alt="" class="w-600 bordered shadow">
         <figcaption>aantal requests voor anonieme gebruikers is beperkt tot 60 per uur</figcaption>
      </figure>
      <h3>met bearer token</h3>
      <p>Je kan als geregistreerde gebruiker dit optrekken naar 5000 per uur door een token te genereren: </p>
      <ul class="arrow">
         <li>ga naar je profiel, settings, developer settings, <strong>personal access tokens</strong></li>
         <li>klik op <strong>Generate new token</strong></li>
         <li>kies een naam, expiration date, en duid de <strong>nodige rechten</strong> aan</li>
         <li>je krijgt een <strong>token string</strong>, b.v. <small><code>ghp_fIWhq1DrL4668baCWMuF7WNO56TvdT1DCdXc</code></small>
         </li>
      </ul>
      <figure>
         <img src="img/05_async/github-token.png" alt="" class="w-600 shadow">
         <figcaption>aanvraag Github bearer token</figcaption>
      </figure>
      <p>Deze token geef je mee met de headers van je request:</p>
      <div class="democontainer">
         <pre class="prism-default language-html line-numbers w-800" data-caption data-demo="demos/05_async/demoGithubApi/index.html"><code>&lt;ul id="lstRepos"&gt;&lt;/ul&gt;</code></pre>
         <pre class="prism-okaida line-numbers w-800" data-caption><code>// declaraties
const lstRepos = document.querySelector('#lstRepos');

// functies
async function getMyRepos() {
   // build request
   const username = 'rogiervdl';
   const url = `https://api.github.com/users/${username}/repos`;
   const options = {
      headers: {
         'Authorization': 'Bearer ghp_fIWhq1DrL...' // geef hier je eigen token mee!
      }
   };

   // fetch data
   const resp = await fetch(url, options); // voeg options toe als tweede parameter
   if (!resp.ok) {
      console.log('opvragen github repos mislukt');
      return;
   }
   const data = await resp.json();

   // return repos
   const repos = data;
   return repos;
}

async function doGetRepos() {
   console.log('fetching repos...');
   const repos = await getMyRepos();
   repos.forEach(repo =&gt; {
      lstRepos.innerHTML += `&lt;li&gt;
      &lt;a href="${repo.html_url}"&gt;${repo.full_name}&lt;/a&gt;
      mdash; ${repo.description}&lt;/li&gt;`;
   });
   console.log('...done');
}

// start fetching repos
doGetRepos();</code></pre>
      </div>

      <p>Je krijgt nu 5000 requests per uur:</p>
      <figure>
         <img src="img/05_async/github-limit2.png" alt="" class="w-600 bordered shadow">
         <figcaption>aantal requests met token is opgetrokken tot 5000 per uur</figcaption>
      </figure>

      <h2>Rapid API voorbeeld: API key, request headers</h2>
      <h3>registratie en API key aanmaken</h3>
      <p>
         Rapid API is niet één API, maar een grote verzameling API's die je kan gebruiken met wisselende
         gebruiksvoorwaarden.
         Het grote voordeel is dat je <strong>maar één keer een API key</strong> hoeft aan te vragen voor alle API's.
         Maak na <a href="https://rapidapi.com/signup">registratie</a> een app aan en ontvang je API key:
      </p>
      <figure>
         <img src="img/05_async/rapid-register.png" alt="" class="w-600">
         <figcaption>Rapid API registratie</figcaption>
      </figure>
      <figure>
         <img src="img/05_async/rapid-key.png" alt="" class="w-400">
         <figcaption>Rapid API API key aanvragen</figcaption>
      </figure>
      <h3>toepassing: Currency Exchange API</h3>
      <p>
         Bij wijze van voorbeeld testen we de <a href="https://rapidapi.com/fyhao/api/currency-exchange/">Currency
            Exchange API</a>.
         Het biedt twee methodes: <strong>listquotes</strong> en <strong>exchange</strong> (panel links) met telkens een
         code voorbeeld (panel rechts; kies Javascript uit de dropdown).
      </p>
      <p>
         Het (kleine) verschil met het Flickr voorbeeld is dat je de <strong>API key als header</strong>, en niet als
         URL parameter moet meegeven.
      </p>
      <img src="img/05_async/currency-doc.png" alt="" class="w-600">
      <div class="democontainer">
         <pre class="prism-default language-html line-numbers w-800" data-caption data-demo="demos/05_async/demoRapidAPI/index.html"><code>&lt;form id="frmCurrencies"&gt;
   &lt;label for="selFrom"&gt;Van:&lt;/label&gt;
   &lt;select id="selFrom"&gt;&lt;/select&gt;
   &lt;label for="selTo"&gt;Naar:&lt;/label&gt;
   &lt;select id="selTo"&gt;&lt;/select &gt;
   &lt;button type="submit"&gt;zoek wisselkoers&lt;/button&gt;
&lt;/form&gt;</code></pre>
         <pre class="prism-atom-dark language-css line-numbers w-800" data-caption><code>body, input {
    font-family: Verdana;
    font-size: 14px;
 }
 button, select {
    border: 1px solid #666;
    padding: 3px 5px;
 }
 form {
    display: grid;
    gap: 10px;
    grid-template-columns: 100px 1fr;
    max-width: 400px;
 }
 [type=submit] {
    justify-self: end;
    grid-column: 1/3;
 }
 .hide {
    visibility: hidden;
 }</code></pre>
         <pre class="prism-okaida line-numbers w-800 h-600" data-caption><code>// declaraties
const frmCurrencies = document.querySelector('#frmCurrencies');
const parMessage = document.querySelector('#parMessage');
const selFrom = document.querySelector('#selFrom');
const selTo = document.querySelector('#selTo');
const fetchOptions = {
   method: 'GET',
   headers: {
      'X-RapidAPI-Key': '8bd0826a8amshbaea...', // vul je eigen key in!
      'X-RapidAPI-Host': 'currency-exchange.p.rapidapi.com'
   }
};

// function: get an array of all available currencies
async function getAllCurrencies() {
   // build request
   const url = 'https://currency-exchange.p.rapidapi.com/listquotes';

   // fetch
   const resp = await fetch(url, fetchOptions);
   if (!resp.ok) {
      console.log('opvragen lijst munten mislukt');
      return;
   }
   const data = await resp.json();

   // return data
   return data;
}

// function: get the exchange rate for two currencies
async function getExchangeRate(curr1, curr2) {
   // build request
   const params = new URLSearchParams();
   params.append('from', curr1);
   params.append('to', curr2);
   const url = `https://currency-exchange.p.rapidapi.com/exchange?${params.toString()}`;

   // fetch
   const resp = await fetch(url, fetchOptions);
   if (!resp.ok) {
      console.log('opvragen wisselkoers mislukt');
      return;
   }
   const data = await resp.json();

   // return data
   return data;
}

// function: populate dropdowns
async function startApp() {
   const currencies = await getAllCurrencies();
   currencies.sort().forEach(curr =&gt; {
      selFrom.innerHTML += `&lt;option&gt;${curr}&lt;/option&gt;`;
      selTo.innerHTML += `&lt;option&gt;${curr}&lt;/option&gt;`;
   });
   frmCurrencies.classList.remove('hide');
   selFrom.value = 'EUR';
   selTo.value = 'USD';
   parMessage.innerHTML = 'selecteer twee munten...';
}

// event handler
async function handleFormSubmit(e) {
   e.preventDefault();
   const rate = await getExchangeRate(selFrom.value, selTo.value);
   parMessage.innerHTML = `1 ${selFrom.value} = ${rate} ${selTo.value}`;
}

// handle form submits
frmCurrencies.addEventListener('submit', handleFormSubmit);

// start your engines
startApp();</code></pre>

      </div>

      <img src="img/05_async/currency-fetch.gif" alt="" class="w-400 bordered">
      <h2>Async/await</h2>
      <h3>Asynchrone functies</h3>
      <p>
         Bij sommige functies &mdash; zoals fetch() &mdash; <strong>weet je niet wanneer ze resultaat geven</strong>.
         Men zegt dat ze <mark>asynchroon</mark> zijn: de rest van de code wacht niet en loopt ondertussen gewoon
         verder! Een screenshot:
      </p>
      <img src="img/05_async/asynchroon.png" alt="" class="w-1000">
      <h3>async/await</h3>
      <p>
         Met <mark>async</mark> ("dit kan even duren, wacht niet op het resultaat") en <mark>await</mark> ("ik wacht
         liever op het resultaat") kan je het asynchroon gedrag sturen. Weer een screenshot:
      </p>
      <img src="img/05_async/asyncawait.png" alt="" class="w-1000">
      <p>
         Async / await is in het begin een beetje verwarrend, maar volgende principes kunnen helpen:
      </p>
      <ul>
         <li>bepaalde functies waarvan de resultaten even op zich kunnen laten wachten &mdash; zoals fetch() &mdash;
            worden asynchroon uitgevoerd: het vervolg van de code wacht niet met uitvoering</li>
         <li>als je toch wil wachten op het resultaat, roep je de functie op met <strong>await</strong></li>
         <li>functies waarin <strong>await</strong> gebruikt wordt, zijn zelf <strong>async</strong> &mdash; de
            resultaten kunnen hier immers ook even op zich laten wachten</li>
      </ul>
      <p>
         Er kunnen situaties zijn waarin het wenselijk is asynchrone functies zonder await op te roepen, bijvoorbeeld
         als de uitvoering geen gevolgen heeft voor het verdere verloop van de code, of als je meerdere processen in
         parallel wil laten lopen, maar je ben altijd veilig met volgende regels:
      </p>
      <div class="tips" data-caption="☝🏼async/await">
         <ul>
            <li>roep asynchrone functies standaard altijd op met <strong>await</strong></li>
            <li>maak functies die await bevatten asynchroon met <strong>async</strong></li>
         </ul>
      </div>
      <h2>API tester &mdash; Postman app</h2>
      <p>
         Met de <a href="https://www.postman.com/downloads/">postman app</a> kan je API's testen zonder code. Je kan
         URL's ingeven, request parameters, headers enz... en de response inspecteren in verschillende formaten.
      </p>
      <p>
         Een aanrader voor wie in detail de request/responses wil testen.
      </p>
      <figure>
         <img src="img/05_async/postman.png" alt="" class="w-800">
         <figcaption>API's testen met Postman</figcaption>
      </figure>
   </main>
   <footer>
      <img src="common/img/thats-all.jpg" alt="">
      <div class="footer__bottom">
         <p>@2024, Rogier van der Linde</p>
         <p>cursussen in dezelfde reeks: <a href="https://rogiervdl.github.io/HTML-course/">HTML</a> &mdash; <a href="https://rogiervdl.github.io/CSS-course/">CSS</a> &mdash; <a href="https://rogiervdl.github.io/CS-course/">C#</a> &mdash; <a href="https://rogiervdl.github.io/DEVENV-course/">ontwikkelomgeving</a></p>
      </div>
   </footer>
   <a aria-label="up" id="up" href="#top"><span class="fas fa-chevron-circle-up"></span></a>
   <!-- popup -->
   <div class="hystmodal dialog" id="diaDemo" aria-hidden="true">
      <div class="hystmodal__wrap">
         <div class="hystmodal__window" role="dialog" aria-modal="true">
            <iframe title="demo"></iframe>
         </div>
      </div>
   </div>
   <!-- scripts -->
   <script src="common/vendor/prism/prism.js"></script>
   <script src="common/vendor/hystmodal/hystmodal.min.js"></script>
   <script src="common/js/mode.js"></script>
   <script src="common/js/scripts.js"></script>
   <!-- Google tag (gtag.js) -->
   <script async src="https://www.googletagmanager.com/gtag/js?id=G-33VMW730V9"></script>
   <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() { dataLayer.push(arguments); }
      gtag('js', new Date());

      gtag('config', 'G-33VMW730V9');
   </script>
</body>

</html>
